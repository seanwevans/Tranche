// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: queries.sql

package db

import (
	"context"
)

const getActiveServices = `-- name: GetActiveServices :many

SELECT id, customer_id, name, primary_cdn, backup_cdn
FROM services
WHERE deleted_at IS NULL
ORDER BY id
`

type GetActiveServicesRow struct {
	ID         int64  `json:"id"`
	CustomerID int64  `json:"customer_id"`
	Name       string `json:"name"`
	PrimaryCdn string `json:"primary_cdn"`
	BackupCdn  string `json:"backup_cdn"`
}

// Services
func (q *Queries) GetActiveServices(ctx context.Context) ([]GetActiveServicesRow, error) {
	rows, err := q.db.QueryContext(ctx, getActiveServices)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []GetActiveServicesRow{}
	for rows.Next() {
		var i GetActiveServicesRow
		if err := rows.Scan(
			&i.ID,
			&i.CustomerID,
			&i.Name,
			&i.PrimaryCdn,
			&i.BackupCdn,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getActiveStormsForService = `-- name: GetActiveStormsForService :many
SELECT id, service_id, kind
FROM storm_events
WHERE service_id = $1
  AND ended_at IS NULL
`

type GetActiveStormsForServiceRow struct {
	ID        int64  `json:"id"`
	ServiceID int64  `json:"service_id"`
	Kind      string `json:"kind"`
}

func (q *Queries) GetActiveStormsForService(ctx context.Context, serviceID int64) ([]GetActiveStormsForServiceRow, error) {
	rows, err := q.db.QueryContext(ctx, getActiveStormsForService, serviceID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []GetActiveStormsForServiceRow{}
	for rows.Next() {
		var i GetActiveStormsForServiceRow
		if err := rows.Scan(&i.ID, &i.ServiceID, &i.Kind); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getServiceDomains = `-- name: GetServiceDomains :many
SELECT id, service_id, name
FROM service_domains
WHERE service_id = $1
ORDER BY id
`

type GetServiceDomainsRow struct {
	ID        int64  `json:"id"`
	ServiceID int64  `json:"service_id"`
	Name      string `json:"name"`
}

func (q *Queries) GetServiceDomains(ctx context.Context, serviceID int64) ([]GetServiceDomainsRow, error) {
	rows, err := q.db.QueryContext(ctx, getServiceDomains, serviceID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []GetServiceDomainsRow{}
	for rows.Next() {
		var i GetServiceDomainsRow
		if err := rows.Scan(&i.ID, &i.ServiceID, &i.Name); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getStormPoliciesForService = `-- name: GetStormPoliciesForService :many

SELECT id, service_id, kind, threshold_avail, window_seconds, cooldown_seconds, max_coverage_factor
FROM storm_policies
WHERE service_id = $1
ORDER BY id
`

type GetStormPoliciesForServiceRow struct {
	ID                int64   `json:"id"`
	ServiceID         int64   `json:"service_id"`
	Kind              string  `json:"kind"`
	ThresholdAvail    float64 `json:"threshold_avail"`
	WindowSeconds     int32   `json:"window_seconds"`
	CooldownSeconds   int32   `json:"cooldown_seconds"`
	MaxCoverageFactor float64 `json:"max_coverage_factor"`
}

// Storm policies/events
func (q *Queries) GetStormPoliciesForService(ctx context.Context, serviceID int64) ([]GetStormPoliciesForServiceRow, error) {
	rows, err := q.db.QueryContext(ctx, getStormPoliciesForService, serviceID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []GetStormPoliciesForServiceRow{}
	for rows.Next() {
		var i GetStormPoliciesForServiceRow
		if err := rows.Scan(
			&i.ID,
			&i.ServiceID,
			&i.Kind,
			&i.ThresholdAvail,
			&i.WindowSeconds,
			&i.CooldownSeconds,
			&i.MaxCoverageFactor,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const insertStormEvent = `-- name: InsertStormEvent :one
INSERT INTO storm_events (service_id, kind)
VALUES ($1, $2)
RETURNING id, service_id, kind
`

type InsertStormEventParams struct {
	ServiceID int64  `json:"service_id"`
	Kind      string `json:"kind"`
}

type InsertStormEventRow struct {
	ID        int64  `json:"id"`
	ServiceID int64  `json:"service_id"`
	Kind      string `json:"kind"`
}

func (q *Queries) InsertStormEvent(ctx context.Context, arg InsertStormEventParams) (InsertStormEventRow, error) {
	row := q.db.QueryRowContext(ctx, insertStormEvent, arg.ServiceID, arg.Kind)
	var i InsertStormEventRow
	err := row.Scan(&i.ID, &i.ServiceID, &i.Kind)
	return i, err
}
